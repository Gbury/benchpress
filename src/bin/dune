(executable
 (name benchpress_bin)
 (public_name benchpress)
 (modes native)
 (promote (into ../..) (until-clean))
 (libraries benchpress containers cmdliner result uuidm logs logs.cli
            tiny_httpd tyxml sqlite3_utils base64)
 (flags :standard -warn-error -3-32 -safe-string -open Benchpress))

(rule
  (targets web_data.ml)
  (deps (:css bootstrap.min.css) (:js embed.js))
  (action
    (with-stdout-to %{targets}
     (progn
       (echo "let css = {css|")
       (cat %{css})
       (echo "|css}")
       (echo "let js = {j|")
       (cat %{js})
       (echo "|j}")
       ))))

(rule
 (with-stdout-to benchpress.1 (run ./benchpress_bin.exe --help=groff)))

(rule
 (with-stdout-to benchpress-run.1 (run ./benchpress_bin.exe run --help=groff)))

(rule
 (with-stdout-to benchpress-serve.1 (run ./benchpress_bin.exe serve --help=groff)))

(install
 (section man)
 (package benchpress)
 (files benchpress.1 benchpress-run.1 benchpress-serve.1))

